## Документация по скриптам в конфигурации

В данном документе описано, как писать `LUA` код для использования
возможностей программы на вашем Twitch канале.

## Доступные модули в `TTvActionHub.LuaTools`

Любой модуль подключается через `TTvActionHub.LuaTools.<модуль>`,
ниже приведена таблица всех возможных подключений, а ниже таблицы пример
подключения модуля работы со звуком.

| Модуль                                    | Описание                                                                               | Документация                       |
| ----------------------------------------- | -------------------------------------------------------------------------------------- | ---------------------------------- |
| `TTvActionHub.LuaTools.Audio.Sounds`      | Этот модуль отвечает за воспроизведение музыки                                         | [Документация](API/RU/Sounds.md)   |
| `TTvActionHub.LuaTools.Hardware.Keyboard` | Этот модуль отвечает за эмуляцию клавиатуры                                            | [Документация](API/RU/Keyboard.md) |
| `TTvActionHub.LuaTools.Hardware.Mouse`    | Этот модуль отвечает за эмуляцию мышки                                                 | [Документация](API/RU/Mouse.md)    |
| `TTvActionHub.LuaTools.Stuff.Chat`        | Этот модуль отвечает за взаимодействие с чатом твича                                   | [Документация](API/RU/Chat.md)     |
| `TTvActionHub.LuaTools.Stuff.Storage`     | Этот модуль отвечает за взаимодействие со специальным внутренним хранилищем            | [Документация](API/RU/Storage.md)  |
| `TTvActionHub.LuaTools.Stuff.Funcs`       | В данном модуле содержатся полезные функции для написание конфигурации                 | [Документация](API/RU/Funcs.md)    |
| `TTvActionHub.LuaTools.Stuff.Users`       | В данном модуле содержатся уровни доступа, которые используются для [команд](#команды) | ~~[Документация]~~                 |

### Пример подключения модуля воспроизвездения музыки.

```lua
local Audio = import('TTvActionHub', 'TTvActionHub.LuaTools.Audio').Sounds
```

## Требования к файлу конфигурации

- Формат файла: конфигурация должна быть файлом `config.lua`.
- Расположение: конфигурация должна находиться в корневом каталоге программы.
- Возвращаемое значение: конфигурация **обязана** возвращать lua-таблицу, содержащую конфигурационную [информацию](#таблица-конфигурации).
- Кодировка: используйте кодировку UTF-8 для ваших скриптов.
  Если что-то из этого не понятно, просто запустите программу без конфигурационного файла, он будет сгенерирован в корневом каталоге.

## Таблица конфигурации

Таблица конфигурации содержит в себе несколько параметров:

| Параметр        | Тип         | Значения   | Описание                                                                                                        | Опционально | Стандартное значение |
| --------------- | ----------- | ---------- | --------------------------------------------------------------------------------------------------------------- | ----------- | -------------------- |
| force-relog     | `bool`      | true/false | Если `true` будет принудительно запрошена авторизация через браузер без попыток обновления информации.          | +           | `false`              |
| timeout         | `int`       | Число      | Стандартное время восстановления для команд чата, если у них не будет указано свое.                             | +           | `30000`              |
| logs            | `bool`      | true/false | Если `true` будут выводиться внутренние логи работы сервисов, связанных с твичом                                | +           | `false`              |
| opening-bracket | `char`      | Символ     | Символ, который будет считаться началом передачи аргументов от участника чата.                                  | +           | `null`               |
| closing-bracket | `char`      | Символ     | Символ, который будет считаться концом передачи аргументов от участника чата.                                   | +           | `null`               |
| rewards         | `lua-table` | Таблица    | Таблица, содержащая в себе определения пользовательских [команд](#команды).                                     | +           | `null`               |
| commands        | `lua-table` | Таблица    | Таблица, содержащая в себе определения пользовательских [наград](#награды)                                      | +           | `null`               |
| tactions        | `lua-table` | Таблица    | Таблица, содержащая в себе определения пользовательских [событий](#временные-события), срабатывающих по таймеру | +           | `null`               |

## Команды

Таблица Commands содержит определения ваших пользовательских команд. Каждый ключ в этой таблице представляет собой имя команды (без префикса «!»). Значение, связанное с именем каждой команды, представляет собой другую таблицу, содержащую следующие ключи

| Ключ    | Тип       | Описание                                                                                                        | Опционально | Стандартное значение                              |
| ------- | --------- | --------------------------------------------------------------------------------------------------------------- | ----------- | ------------------------------------------------- |
| action  | Функция   | Функция, которая будет выполняться при срабатывании команды. Имеет два принимаемых аргумента `sender` и `args`. | -           | -                                                 |
| timeout | int       | Время восстановления для команды. Измеряется в мс. Три возможных значениея: -1, 0, > 0                          | +           | Значение из [конфигурации](#таблица-конфигурации) |
| perm    | enum(int) | Уровень доступа к командам. Определяется целым числом от 0 до 4. (стандартное значение 0)                       | +           | 0 (VIEWIER)                                       |

Так как `perm` является в первую очередь enum'ом, у него есть прописные значения, которые можно использовать, дабы понимать какой уровень доступа вы выдаете на команду:

```cs
enum USERLEVEL: int
    {
        VIEWIER = 0, VIP = 1, SUB = 2, MODERATOR = 3, BROADCASTER = 4
    }
```

Так как функция, которую принимает в себя поле `action` не такое простое, то немного подробнее про него:

| Аргумент | Тип      | Описание                                                                                                              |
| -------- | -------- | --------------------------------------------------------------------------------------------------------------------- |
| sender   | string   | Строчка, которая содержит в себе ник Twitch пользователя, который отправил эту команду.                               |
| args     | string[] | Массив строчек, содержащий в себе все слова, которые написал пользователь, отправив эту команду, разбитые по пробелам |

Пример создания команды:

```lua
local commands = {}
-- Some other usefull code...
local cmd1 = {}
cmd1["action"] =
    function(sender, args)
        -- Some usefull work here with sender and args
    end
cmd1["timeout"] = 1000 -- 1 second cooldown
cmd1["perm"] = Users.USERLEVEL.VIEWIER
commands["testcmd"] = cmd1
```

## Награды

Таблица Rewards содержит определения ваших пользовательских наград. Каждый ключ в этой таблице представляет собой имя награды (которое вы указали в панели твича). Значение, связанное с именем каждой награды, представляет собой другую таблицу, содержащую следующие ключи

| Ключ   | Тип     | Описание                                                                                                     | Опционально |
| ------ | ------- | ------------------------------------------------------------------------------------------------------------ | ----------- |
| action | Функция | Функция, которая будет выполняться при активации награды. Имеет два принимаемых аргумента `sender` и `args`. | -           |

Так как функция, которую принимает в себя поле `action` не такое простое, то немного подробнее про него:

| Аргумент | Тип      | Описание                                                                                                              |
| -------- | -------- | --------------------------------------------------------------------------------------------------------------------- |
| sender   | string   | Строчка, которая содержит в себе ник Twitch пользователя, который отправил эту команду.                               |
| args     | string[] | Массив строчек, содержащий в себе все слова, которые написал пользователь, отправив эту команду, разбитые по пробелам |

Пример создания награды:

```lua
local rewards = {}
-- Some other usefull code...
local reward1 = {}
reward1["action"] =
    function(sender, args)
        -- Some usefull work here with sender and args
    end

rewards["testreward"] = reward1
```

## Временные события

Таблица tactions содержит определения ваших пользовательских событий. Каждый ключ в этой таблице представляет собой имя события (которое вы указали в панели твича). Значение, связанное с именем каждого события, представляет собой другую таблицу, содержащую следующие ключи

| Ключ    | Тип     | Описание                                                                                          | Опционально |
| ------- | ------- | ------------------------------------------------------------------------------------------------- | ----------- |
| action  | Функция | Функция, которая будет выполняться при активации награды. Не имеет в себе принимаемых аргументов. | -           |
| timeout | integer | Временной промежуток, через который данное событие будет вызвано. Доступны любые значения >= 1    | -           |

Так как функция, которую принимает в себя поле `action` простое, то никаких аргументов в себя функция не принимает.

Пример создания награды:

```lua
local tactions = {}
-- Some other usefull code...
local taction1 = {}
taction1["action"] =
    function()
        Chat.SendMessageAsync("Test")
    end
taction1["timeout"] = 5000
tactions["test"] = taction1

```
