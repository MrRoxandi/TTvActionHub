# Документация по скриптам в конфигурации

В данном документе описано, как писать `LUA` "код" для использования возможностей программы на вашем Twitch канале.

## Доступные модули в `TTvActionHub.LuaTools`

Любой модуль подключается через `TTvActionHub.LuaTools.<модуль>`, ниже приведена таблица всех возможных подключений, а ниже таблицы пример подключения модуля работы со звуком.

| Модуль        | Описание                                                                                                     | Документация                          |
|---------------|--------------------------------------------------------------------------------------------------------------|---------------------------------------|
| `Keyboard`    | Этот модуль отвечает за эмуляцию клавиатуры                                                                  | [Документация](API/RU/Keyboard.md)    |
| `Mouse`       | Этот модуль отвечает за эмуляцию мышки                                                                       | [Документация](API/RU/Mouse.md)       |
| `Audio`       | Этот модуль отвечает взаимодействие с сервисом звука (воспроизведение аудиофайлов) за воспроизведение музыки | [Документация](API/RU/Audio.md)       |
| `Container`   | Этот модуль отвечает за взаимодействие со специальным внутренним хранилищем                                  | [Документация](API/RU/Container.md)   |
| `TwitchTools` | Этот модуль отвечает за взаимодействие с твичом                                                              | [Документация](API/RU/TwitchTools.md) |
| `Funcs`       | В данном модуле содержатся полезные функции для написание конфигурации                                       | [Документация](API/RU/Funcs.md)       |

## Требования к файлам конфигурации

- Формат файла: конфигурация должна быть файлом `lua`.
- Расположение: конфигурация должна находиться в каталоге `..\configs\`.
- Возвращаемое значение: конфигурация **обязана** возвращать lua-таблицу, содержащую конфигурационную информацию.
- Кодировка: используйте кодировку UTF-8 для ваших скриптов.
  Если что-то из этого не понятно, просто запустите программу без файлов конфигурации, они будут сгенерированы автоматически.

## Таблица основной конфигурации (файл ../configs/config.lua) [Пример](example/config.md)

Таблица конфигурации содержит в себе несколько параметров:

| Параметр    | Тип    | Значения   | Описание                                                                                               | Опционально | Стандартное значение |
|-------------|--------|------------|--------------------------------------------------------------------------------------------------------|-------------|----------------------|
| force-relog | `bool` | true/false | Если `true` будет принудительно запрошена авторизация через браузер без попыток обновления информации. | +           | `false`              |
| timeout     | `int`  | Число      | Стандартное время восстановления для команд чата, если у них не будет указано свое.                    | +           | `30000`              |
| logs        | `bool` | true/false | Если `true` будут выводиться внутренние логи работы сервисов, связанных с твичом                       | +           | `false`              |

## События (файл ../configs/twitchevents.lua) [Пример](example/twitchevents.md)

Таблица twitchevents содержит определения ваших пользовательских событий. Каждый ключ в этой таблице представляет собой имя события. Значение, связанное с именем каждого события, представляет собой другую таблицу, содержащую следующие ключи:

| Ключ    | Тип         | Описание                                                                                                        | Опционально | Стандартное значение  |
|---------|-------------|-----------------------------------------------------------------------------------------------------------------|-------------|-----------------------|
| kind    | Тип события | Определяет тип события: Команда, награда за баллы канала или другое.                                            | -           | -                     |
| action  | Функция     | Функция, которая будет выполняться при срабатывании команды. Имеет два принимаемых аргумента `sender` и `args`. | -           | -                     |
| timeout | int         | Время восстановления для команды. Измеряется в мс. Три возможных значения: -1, 0, > 0                           | +           | timeout из config.lua |
| perm    | enum(int)   | Уровень доступа к событию.                                                                                      | +           | Viewer                |
| cost    | long        | Определяет стоимость для вызова события.                                                                        | +           | 0                     |

Параметр `kind` является `TwitchEventKind` и может принимать всего два значения. Структура параметра `kind` приведена ниже.

```cs
public enum TwitchEventKind : byte
{
    Command = 0, TwitchReward
}
```

Ниже приведен пример использования.

```lua
-- ...
twitchevents['test'] = {}
twitchevents['test']['kind'] = TwitchTools.TwitchEventKind("Command") -- TwitchTools.TwitchEventKind.TwitchReward
-- ...
```

Параметр `action` является `lua-функцией`. Пример написания и использования других модулей приведен ниже.

```lua
-- ...
twitchevents['test'] = {}
twitchevents['test']['action'] =
  function(sender, args)
    TwitchTools.SendMessage('@' .. sender .. ' -> test')
  end
-- ...
```

Принимаемые функцией параметры `sender` и `args`:

- `sender` - строчка содержит в себе ник Twitch пользователя, который отправил эту команду.
- `args` - массив строчек, содержащий в себе все слова, которые написал пользователь, отправив эту команду, разбитые по пробелам

Параметр `perm` является `PermissionLevel` и может принимать всего пять значений значения. Структура параметра параметра `perm` приведена ниже.

```cs
public enum PermissionLevel : int
{
    Viewer, Vip, Subscriber, Moderator, Broadcaster
}
```

Ниже приведен пример использования.

```lua
-- ...
twitchevents['test'] = {}
twitchevents['test']['perm'] = TwitchTools.PermissionLevel("Vip") -- TwitchTools.PermissionLevel.Viewer
-- ...
```

## Временные события (Файл ../configs/timeractions.lua) [Пример](example/timeractions.md)

Таблица tactions содержит определения ваших пользовательских событий. Каждый ключ в этой таблице представляет собой имя события (которое вы указали в панели твича). Значение, связанное с именем каждого события, представляет собой другую таблицу, содержащую следующие ключи

| Ключ    | Тип     | Описание                                                                                          | Опционально |
|---------|---------|---------------------------------------------------------------------------------------------------|-------------|
| action  | Функция | Функция, которая будет выполняться при активации награды. Не имеет в себе принимаемых аргументов. | -           |
| timeout | integer | Временной промежуток, через который данное событие будет вызвано. Доступны любые значения >= 1    | -           |

Так как функция, которую принимает в себя поле `action` простое, то никаких аргументов в себя функция не принимает.

Пример создания награды:

```lua
local tactions = {}
-- Some other usefull code...
local taction1 = {}
taction1["action"] =
  function(sender, args)
    TwitchTools.SendMessage('@' .. sender .. ' -> test')
  end
taction1["timeout"] = 5000
tactions["test"] = taction1

```
