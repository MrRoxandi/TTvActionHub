# Документация по скриптам в конфигурации

В данном документе описано, как писать `LUA` код для использования
возможностей программы на вашем Twitch канале.

## Доступные модули в `TTvActionHub.LuaTools`

Любой модуль подключается через `TTvActionHub.LuaTools.<модуль>`,
ниже приведена таблица всех возможных подключений, а ниже таблицы пример
подключения модуля работы со звуком.

| Модуль                                    | Описание                                                                    | Документация                          |
| ----------------------------------------- | --------------------------------------------------------------------------- | ------------------------------------- |
| `TTvActionHub.LuaTools.Audio.Sounds`      | Этот модуль отвечает за воспроизведение музыки                              | [Документация](API/RU/Sounds.md)      |
| `TTvActionHub.LuaTools.Hardware.Keyboard` | Этот модуль отвечает за эмуляцию клавиатуры                                 | [Документация](API/RU/Keyboard.md)    |
| `TTvActionHub.LuaTools.Hardware.Mouse`    | Этот модуль отвечает за эмуляцию мышки                                      | [Документация](API/RU/Mouse.md)       |
| `TTvActionHub.LuaTools.Stuff.TwitchTools` | Этот модуль отвечает за взаимодействие с твичом                             | [Документация](API/RU/TwitchTools.md) |
| `TTvActionHub.LuaTools.Stuff.Storage`     | Этот модуль отвечает за взаимодействие со специальным внутренним хранилищем | [Документация](API/RU/Storage.md)     |
| `TTvActionHub.LuaTools.Stuff.Funcs`       | В данном модуле содержатся полезные функции для написание конфигурации      | [Документация](API/RU/Funcs.md)       |

## Пример подключения модуля воспроизвездения музыки

```lua
local Audio = import('TTvActionHub', 'TTvActionHub.LuaTools.Audio').Sounds
```

## Требования к файлу конфигурации

- Формат файла: конфигурация должна быть файлом `config.lua`.
- Расположение: конфигурация должна находиться в корневом каталоге программы.
- Возвращаемое значение: конфигурация **обязана** возвращать lua-таблицу, содержащую конфигурационную [информацию](#таблица-конфигурации-файл-configsconfiglua-пример).
- Кодировка: используйте кодировку UTF-8 для ваших скриптов.
  Если что-то из этого не понятно, просто запустите программу без конфигурационного файла, он будет сгенерирован в корневом каталоге.

## Таблица конфигурации (файл ../configs/config.lua) [Пример](example/config.md)

Таблица конфигурации содержит в себе несколько параметров:

| Параметр    | Тип    | Значения   | Описание                                                                                               | Опционально | Стандартное значение |
| ----------- | ------ | ---------- | ------------------------------------------------------------------------------------------------------ | ----------- | -------------------- |
| force-relog | `bool` | true/false | Если `true` будет принудительно запрошена авторизация через браузер без попыток обновления информации. | +           | `false`              |
| timeout     | `int`  | Число      | Стандартное время восстановления для команд чата, если у них не будет указано свое.                    | +           | `30000`              |
| logs        | `bool` | true/false | Если `true` будут выводиться внутренние логи работы сервисов, связанных с твичом                       | +           | `false`              |

## События (файл ../configs/twitchevents.lua) [Пример](example/twitchevents.md)

Таблица twitchevents содержит определения ваших пользовательских событий. Каждый ключ в этой таблице представляет собой имя события (без префикса «!»). Значение, связанное с именем каждого события, представляет собой другую таблицу, содержащую следующие ключи

| Ключ    | Тип         | Описание                                                                                                        | Опционально | Стандартное значение  |
| ------- | ----------- | --------------------------------------------------------------------------------------------------------------- | ----------- | --------------------- |
| kind    | Тип события | Определяет тип события: Команда, награда за баллы канала или другое.                                            | -           | -                     |
| action  | Функция     | Функция, которая будет выполняться при срабатывании команды. Имеет два принимаемых аргумента `sender` и `args`. | -           | -                     |
| timeout | int         | Время восстановления для команды. Измеряется в мс. Три возможных значениея: -1, 0, > 0                          | +           | timeout из config.lua |
| perm    | enum(int)   | Уровень доступа к событию. Определяется целым числом от 0 до 4. (стандартное значение 0)                        | +           | 0 (VIEWIER)           |

Так как `perm` является в первую очередь enum'ом, у него есть прописные значения. См, [документацию](API/RU/TwitchTools.md)

Так как функция, которую принимает в себя поле `action` не такое простое, то немного подробнее про него:

| Аргумент | Тип      | Описание                                                                                                              |
| -------- | -------- | --------------------------------------------------------------------------------------------------------------------- |
| sender   | string   | Строчка, которая содержит в себе ник Twitch пользователя, который отправил эту команду.                               |
| args     | string[] | Массив строчек, содержащий в себе все слова, которые написал пользователь, отправив эту команду, разбитые по пробелам |

## Временные события (Файл ../configs/timeractions.lua) [Пример](example/timeractions.md)

Таблица tactions содержит определения ваших пользовательских событий. Каждый ключ в этой таблице представляет собой имя события (которое вы указали в панели твича). Значение, связанное с именем каждого события, представляет собой другую таблицу, содержащую следующие ключи

| Ключ    | Тип     | Описание                                                                                          | Опционально |
| ------- | ------- | ------------------------------------------------------------------------------------------------- | ----------- |
| action  | Функция | Функция, которая будет выполняться при активации награды. Не имеет в себе принимаемых аргументов. | -           |
| timeout | integer | Временной промежуток, через который данное событие будет вызвано. Доступны любые значения >= 1    | -           |

Так как функция, которую принимает в себя поле `action` простое, то никаких аргументов в себя функция не принимает.

Пример создания награды:

```lua
local tactions = {}
-- Some other usefull code...
local taction1 = {}
taction1["action"] =
    function()
        Chat.SendMessageAsync("Test")
    end
taction1["timeout"] = 5000
tactions["test"] = taction1

```
